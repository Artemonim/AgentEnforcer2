# =============================================================================
# run.ps1 â€” Thin Wrapper (Entry Point)
# =============================================================================
# This is the user-facing entry point for local CI.
# It validates CLI flags and forwards execution to build.ps1.
#
# Adapt this template to your project's needs.
# =============================================================================

#region Parameters
param(
    # Profiles
    [switch]$Fast,           # Skip coverage and heavy stages
    [switch]$Release,        # Build release artifacts
    
    # Skip flags
    [switch]$SkipLint,       # Skip formatting and linting
    [switch]$SkipTests,      # Skip test suite
    [switch]$SkipCoverage,   # Skip coverage collection
    [switch]$SkipLaunch,     # Skip app launch after CI
    
    # Cache control
    [switch]$NoCache,        # Ignore cached stages
    [switch]$Clean,          # Delete cache before running
    
    # Heartbeat tuning
    [int]$HeartbeatSec = 60,
    
    # Help
    [Alias('h', '?')]
    [switch]$Help
)
#endregion Parameters

#region Validation
$knownParamNames = @(
    'Fast', 'Release',
    'SkipLint', 'SkipTests', 'SkipCoverage', 'SkipLaunch',
    'NoCache', 'Clean',
    'HeartbeatSec',
    'Help'
)

# Reject unknown parameters (PowerShell places them in $args)
if ($args) {
    Write-Host ("Error: Unknown parameter(s): {0}" -f ($args -join ', ')) -ForegroundColor Red
    Write-Host ("Valid parameters: -{0}" -f ($knownParamNames -join ', -')) -ForegroundColor Yellow
    exit 1
}
#endregion Validation

#region Help
function Show-Help {
    Write-Host "Local CI Runner" -ForegroundColor Cyan
    Write-Host ""
    Write-Host "Usage: .\run.ps1 [options]"
    Write-Host ""
    Write-Host "Profiles:"
    Write-Host "  -Fast              Skip coverage and heavy stages"
    Write-Host "  -Release           Build release artifacts"
    Write-Host ""
    Write-Host "Skip Flags:"
    Write-Host "  -SkipLint          Skip formatting and linting"
    Write-Host "  -SkipTests         Skip test suite"
    Write-Host "  -SkipCoverage      Skip coverage collection"
    Write-Host "  -SkipLaunch        Skip app launch after CI"
    Write-Host ""
    Write-Host "Cache Control:"
    Write-Host "  -NoCache           Ignore cached stages"
    Write-Host "  -Clean             Delete cache before running"
    Write-Host ""
    Write-Host "Other:"
    Write-Host "  -HeartbeatSec N    Heartbeat interval (default: 60)"
    Write-Host "  -Help              Show this help"
}

if ($Help) {
    Show-Help
    exit 0
}
#endregion Help

#region Forward to Orchestrator
$ScriptRoot = Split-Path -Parent $MyInvocation.MyCommand.Path
& (Join-Path $ScriptRoot "build.ps1") @PSBoundParameters
exit $LASTEXITCODE
#endregion Forward to Orchestrator
